var config = require('./config.js')
  , net = require('net')
  , machinelearning = require('./machine_learning.js'); 


var server, browserSocket, priceSocket, tradeSocket, appSocket;

exports.csvClientData = function( data ){
  if(appSocket == undefined || appSocket == null){
    return false;
  }else{
    appSocket.emit('csv_exchange_connection',data);
  }
}

exports.pulseClientData = function (data){
  if(appSocket == undefined || appSocket == null){
    return false;
    }else{
      appSocket.emit('pulse_exchange_connection',data);
    }
}

exports.mlPerformanceData = function(data){
  if(appSocket == undefined || appSocket == null){
    return false;
  }else{
    appSocket.emit('ml_data_connection', data);
  }
}

exports.start = function(io){
  initBrowserConn(io);
}

function initBrowserConn(io){
  var initExchnageConn = this.initExchangeConn;
  
  io.sockets.on('connection', function(socket){
    console.log('SERVER: CONNECTION WITH BROWSER CLIENT ESTABLISHED');
    appSocket = socket; 
    socket.on('start_exchange_connection', function(){
      console.log('SERVER: RECEIVED REQUEST TO INITIATE CONN WITH EXCHAGE SERVER');
//      initExchangeConn();
    });
    socket.on('pulse_ready',function(){
        machinelearning.pulseForecast([]);
    });
    socket.on('ml_performance_ready', function(){
      machinelearning.trainAndTest();
    });
  });
}

