var config = require('./config.js')
  , net = require('net'); 

var server, browserSocket, priceSocket, tradeSocket, appSocket;

exports.csvClientData = function( data ){
  if(appSocket == undefined || appSocket == null){
    return false;
  }else{
    appSocket.emit('csv_exchange_connection',data);
  }

}
exports.start = function(io){
  initBrowserConn(io);
}

function initBrowserConn(io){
  var initExchnageConn = this.initExchangeConn;
  
  io.sockets.on('connection', function(socket){
    console.log('SERVER: CONNECTION WITH BROWSER CLIENT ESTABLISHED');
    appSocket = socket; 
    socket.on('start_exchange_connection', function(){
      console.log('SERVER: RECEIVED REQUEST TO INITIATE CONN WITH EXCHAGE SERVER');
      initExchangeConn();
    });
  });
}

function initExchangeConn(){
  priceSocket = net.connect({port: config.PRICE_PORT});
  tradeSocket = net.connect({port: config.BOOK_PORT}); 
  
  priceSocket.on('connect', function(){
    console.log('Price client connected on port 3000');
    priceSocket.write('H\r\n');
  });

  priceSocket.on('data', function(data){
    console.log('Data Received\n'+data.toString()+'\n');
  });

  priceSocket.on('end', function(){
    console.log('client disconnected');
  });
}
